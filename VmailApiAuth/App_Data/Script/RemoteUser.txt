 
 
Create Table VmailUser
(
Id int Identity(1,1),
Userid int NOT NULL,
AuthCount int default 0 NOT NULL,
HITCount int default 0 NOT NULL,
IsAuthenticated int default 0
)
-------------------------------------------------
CREATE  Proc SpVmailUser
(
	@UserId int
)
AS
BEGIN
 
Declare @HITCount int=0;
Declare @AuthCount int=0;
SET @HITCount=(SELECT HITCount FROM VmailUser Where Userid=@UserId)
SET @AuthCount=(SELECT AuthCount FROM VmailUser Where Userid=@UserId)

  Update VmailUser SET HITCount=@HITCount+1 Where Userid=@UserId

  IF(@HITCount=@AuthCount)
    Update VmailUser SET IsAuthenticated=1 Where Userid=@UserId
ELSE
	SET @HITCount=(SELECT HITCount FROM VmailUser Where Userid=@UserId)

  



  SELECT @HITCount AS RESPONSE

EnD
GO
--------------------------------------------------

 Insert into VmailUser(Userid,AuthCount,HITCount,IsAuthenticated) Values (1,0,0,0)

  Exec SpVmailUser 1